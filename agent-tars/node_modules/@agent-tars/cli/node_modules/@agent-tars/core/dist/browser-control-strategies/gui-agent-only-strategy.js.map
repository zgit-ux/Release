{"version":3,"file":"browser-control-strategies/gui-agent-only-strategy.js","sources":["webpack://@agent-tars/core/./src/browser-control-strategies/gui-agent-only-strategy.ts"],"sourcesContent":["/*\n * Copyright (c) 2025 Bytedance, Inc. and its affiliates.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { toMarkdown } from '@agent-infra/shared';\nimport { ToolDefinition, Tool, z } from '@multimodal/mcp-agent';\nimport { AbstractBrowserControlStrategy } from './base-strategy';\n\n/**\n * GUIAgentOnlyStrategy - Implements the 'gui-agent-only' browser control mode\n *\n * This strategy exclusively uses the GUI Agent for browser control, with custom\n * implementations for essential browser functions like navigation, without depending\n * on the MCP Browser server.\n */\nexport class GUIAgentOnlyStrategy extends AbstractBrowserControlStrategy {\n  /**\n   * Register GUI Agent tool and self-implemented browser tools\n   */\n  async registerTools(registerToolFn: (tool: ToolDefinition) => void): Promise<string[]> {\n    // Register GUI Agent tool if available\n    if (this.guiAgent) {\n      const guiAgentTool = this.guiAgent.getToolDefinition();\n      registerToolFn(guiAgentTool);\n      this.registeredTools.add(guiAgentTool.name);\n\n      // Register custom browser tools that don't rely on MCP Browser server\n      this.registerCustomBrowserTools(registerToolFn);\n    }\n\n    return Array.from(this.registeredTools);\n  }\n\n  /**\n   * Register custom browser tools implemented within the GUI Agent\n   */\n  private registerCustomBrowserTools(registerToolFn: (tool: ToolDefinition) => void): void {\n    // Register navigation tool\n    const navigateTool = new Tool({\n      id: 'browser_navigate',\n      description: '[browser] Navigate to a URL',\n      parameters: z.object({\n        url: z.string().describe('URL to navigate to'),\n      }),\n      function: async ({ url }) => {\n        try {\n          if (!this.guiAgent) {\n            return { status: 'error', message: 'GUI Agent not initialized' };\n          }\n\n          const page = await this.guiAgent.getPage();\n          await page.goto(url, { waitUntil: 'networkidle2' });\n\n          return {\n            status: 'success',\n            message: `Navigated to ${url}`,\n          };\n        } catch (error) {\n          this.logger.error(`Error navigating to URL: ${error}`);\n          return {\n            status: 'error',\n            message: `Failed to navigate: ${error instanceof Error ? error.message : String(error)}`,\n          };\n        }\n      },\n    });\n\n    // Register back navigation tool\n    const backTool = new Tool({\n      id: 'browser_back',\n      description: '[browser] Go back to the previous page',\n      parameters: z.object({}),\n      function: async () => {\n        try {\n          if (!this.guiAgent) {\n            return { status: 'error', message: 'GUI Agent not initialized' };\n          }\n\n          const page = await this.guiAgent.getPage();\n          await page.goBack();\n\n          return {\n            status: 'success',\n            message: 'Navigated back',\n          };\n        } catch (error) {\n          this.logger.error(`Error navigating back: ${error}`);\n          return {\n            status: 'error',\n            message: `Failed to navigate back: ${error instanceof Error ? error.message : String(error)}`,\n          };\n        }\n      },\n    });\n\n    // Register forward navigation tool\n    const forwardTool = new Tool({\n      id: 'browser_forward',\n      description: '[browser] Go forward to the next page',\n      parameters: z.object({}),\n      function: async () => {\n        try {\n          if (!this.guiAgent) {\n            return { status: 'error', message: 'GUI Agent not initialized' };\n          }\n\n          const page = await this.guiAgent.getPage();\n          await page.goForward();\n\n          return {\n            status: 'success',\n            message: 'Navigated forward',\n          };\n        } catch (error) {\n          this.logger.error(`Error navigating forward: ${error}`);\n          return {\n            status: 'error',\n            message: `Failed to navigate forward: ${error instanceof Error ? error.message : String(error)}`,\n          };\n        }\n      },\n    });\n\n    // Register refresh tool\n    const refreshTool = new Tool({\n      id: 'browser_refresh',\n      description: '[browser] Refresh the current page',\n      parameters: z.object({}),\n      function: async () => {\n        try {\n          if (!this.guiAgent) {\n            return { status: 'error', message: 'GUI Agent not initialized' };\n          }\n\n          const page = await this.guiAgent.getPage();\n          await page.reload();\n\n          return {\n            status: 'success',\n            message: 'Page refreshed',\n          };\n        } catch (error) {\n          this.logger.error(`Error refreshing page: ${error}`);\n          return {\n            status: 'error',\n            message: `Failed to refresh: ${error instanceof Error ? error.message : String(error)}`,\n          };\n        }\n      },\n    });\n\n    // Register get markdown tool\n    const getMarkdownTool = new Tool({\n      id: 'browser_get_markdown',\n      description: '[browser] Get the content of the current page as markdown',\n      parameters: z.object({}),\n      function: async () => {\n        try {\n          if (!this.guiAgent) {\n            return { status: 'error', message: 'GUI Agent not initialized' };\n          }\n\n          const page = await this.guiAgent.getPage();\n\n          // Extract page content using Readability\n          const markdown = await page.evaluate(() => {\n            // Simple markdown conversion from HTML\n            const convertToMarkdown = (html: string) => {\n              const div = document.createElement('div');\n              div.innerHTML = html;\n\n              // Remove script and style elements\n              const scripts = div.querySelectorAll('script, style');\n              scripts.forEach((el) => el.remove());\n\n              // Simple text extraction\n              return div.textContent || '';\n            };\n\n            return convertToMarkdown(document.body.innerHTML);\n          });\n\n          return markdown;\n        } catch (error) {\n          this.logger.error(`Error extracting markdown: ${error}`);\n          return `Failed to extract content: ${error instanceof Error ? error.message : String(error)}`;\n        }\n      },\n    });\n\n    // Register URL and title tools\n    const getUrlTool = new Tool({\n      id: 'browser_get_url',\n      description: '[browser] Get the current page URL',\n      parameters: z.object({}),\n      function: async () => {\n        try {\n          if (!this.guiAgent) {\n            return { status: 'error', message: 'GUI Agent not initialized' };\n          }\n\n          const page = await this.guiAgent.getPage();\n          return await page.url();\n        } catch (error) {\n          this.logger.error(`Error getting URL: ${error}`);\n          return `Failed to get URL: ${error instanceof Error ? error.message : String(error)}`;\n        }\n      },\n    });\n\n    const getTitleTool = new Tool({\n      id: 'browser_get_title',\n      description: '[browser] Get the current page title',\n      parameters: z.object({}),\n      function: async () => {\n        try {\n          if (!this.guiAgent) {\n            return { status: 'error', message: 'GUI Agent not initialized' };\n          }\n\n          const page = await this.guiAgent.getPage();\n          return await page.title();\n        } catch (error) {\n          this.logger.error(`Error getting title: ${error}`);\n          return `Failed to get title: ${error instanceof Error ? error.message : String(error)}`;\n        }\n      },\n    });\n\n    // Register all tools\n    [\n      navigateTool,\n      backTool,\n      forwardTool,\n      refreshTool,\n      // getMarkdownTool,\n      getUrlTool,\n      getTitleTool,\n    ].forEach((tool) => {\n      registerToolFn(tool);\n      this.registeredTools.add(tool.name);\n    });\n\n    this.logger.info(`Registered ${this.registeredTools.size} custom browser tools`);\n  }\n}\n"],"names":["GUIAgentOnlyStrategy","AbstractBrowserControlStrategy","registerToolFn","guiAgentTool","Array","navigateTool","Tool","z","url","page","error","Error","String","backTool","forwardTool","refreshTool","markdown","convertToMarkdown","html","div","document","scripts","el","getUrlTool","getTitleTool","tool"],"mappings":"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"}