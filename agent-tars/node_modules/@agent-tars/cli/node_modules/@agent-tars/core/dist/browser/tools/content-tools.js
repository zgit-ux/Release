/**
* Copyright (c) 2025 Bytedance, Inc. and its affiliates.
* SPDX-License-Identifier: Apache-2.0
*/
"use strict";
var __webpack_require__ = {};
(()=>{
    __webpack_require__.d = (exports1, definition)=>{
        for(var key in definition)if (__webpack_require__.o(definition, key) && !__webpack_require__.o(exports1, key)) Object.defineProperty(exports1, key, {
            enumerable: true,
            get: definition[key]
        });
    };
})();
(()=>{
    __webpack_require__.o = (obj, prop)=>Object.prototype.hasOwnProperty.call(obj, prop);
})();
(()=>{
    __webpack_require__.r = (exports1)=>{
        if ('undefined' != typeof Symbol && Symbol.toStringTag) Object.defineProperty(exports1, Symbol.toStringTag, {
            value: 'Module'
        });
        Object.defineProperty(exports1, '__esModule', {
            value: true
        });
    };
})();
var __webpack_exports__ = {};
__webpack_require__.r(__webpack_exports__);
__webpack_require__.d(__webpack_exports__, {
    ContentTools: ()=>ContentTools
});
const mcp_agent_namespaceObject = require("@multimodal/mcp-agent");
const external_base_js_namespaceObject = require("./base.js");
class ContentTools extends external_base_js_namespaceObject.CustomBrowserTool {
    getTools() {
        const tools = [];
        const getMarkdownTool = new mcp_agent_namespaceObject.Tool({
            id: 'browser_get_markdown',
            description: '[browser] Get the content of the current page as markdown',
            parameters: mcp_agent_namespaceObject.z.object({
                selector: mcp_agent_namespaceObject.z.string().optional().describe('CSS selector to extract content from (optional)')
            }),
            function: async ({ selector })=>{
                try {
                    if (!this.browserGUIAgent) return {
                        error: 'GUI Agent not initialized'
                    };
                    const page = await this.getPage();
                    const markdown = await page.evaluate((targetSelector)=>{
                        function htmlToMarkdown(element) {
                            if (!element) return '';
                            const style = window.getComputedStyle(element);
                            if ('none' === style.display || 'hidden' === style.visibility || '0' === style.opacity) return '';
                            const tag = element.tagName.toLowerCase();
                            let result = '';
                            switch(tag){
                                case 'h1':
                                    return `\n# ${element.textContent.trim()}\n\n`;
                                case 'h2':
                                    return `\n## ${element.textContent.trim()}\n\n`;
                                case 'h3':
                                    return `\n### ${element.textContent.trim()}\n\n`;
                                case 'h4':
                                    return `\n#### ${element.textContent.trim()}\n\n`;
                                case 'h5':
                                    return `\n##### ${element.textContent.trim()}\n\n`;
                                case 'h6':
                                    return `\n###### ${element.textContent.trim()}\n\n`;
                                case 'p':
                                    return `\n${element.textContent.trim()}\n\n`;
                                case 'a':
                                    const href = element.getAttribute('href');
                                    if (href) return `[${element.textContent.trim()}](${href})`;
                                    return element.textContent.trim();
                                case 'strong':
                                case 'b':
                                    return `**${element.textContent.trim()}**`;
                                case 'em':
                                case 'i':
                                    return `*${element.textContent.trim()}*`;
                                case 'code':
                                    return `\`${element.textContent.trim()}\``;
                                case 'pre':
                                    return `\n\`\`\`\n${element.textContent.trim()}\n\`\`\`\n\n`;
                                case 'ul':
                                    {
                                        let listItems = '';
                                        for (const child of element.children)if ('li' === child.tagName.toLowerCase()) listItems += `\n- ${child.textContent.trim()}`;
                                        return `${listItems}\n\n`;
                                    }
                                case 'ol':
                                    {
                                        let listItems = '';
                                        let index = 1;
                                        for (const child of element.children)if ('li' === child.tagName.toLowerCase()) {
                                            listItems += `\n${index}. ${child.textContent.trim()}`;
                                            index++;
                                        }
                                        return `${listItems}\n\n`;
                                    }
                                case 'img':
                                    {
                                        const alt = element.getAttribute('alt') || 'image';
                                        const src = element.getAttribute('src') || '';
                                        return `\n![${alt}](${src})\n\n`;
                                    }
                                case 'blockquote':
                                    return `\n> ${element.textContent.trim()}\n\n`;
                                case 'hr':
                                    return '\n---\n\n';
                                case 'table':
                                    return `\n[Table content: ${element.textContent.trim()}]\n\n`;
                                case 'br':
                                    return '\n';
                                default:
                                    if (element.children && element.children.length > 0) {
                                        for (const child of element.children)result += htmlToMarkdown(child);
                                        return result;
                                    }
                                    {
                                        const text = element.textContent.trim();
                                        return text ? text : '';
                                    }
                            }
                        }
                        try {
                            const title = document.title;
                            let markdown = `# ${title}\n\n`;
                            const target = targetSelector ? document.querySelector(targetSelector) : document.body;
                            if (!target) return `# ${title}\n\nNo content found for selector: ${targetSelector}`;
                            markdown += htmlToMarkdown(target);
                            return markdown.replace(/\n{3,}/g, '\n\n').trim();
                        } catch (error) {
                            return `Error converting to markdown: ${error.message}`;
                        }
                    }, selector || null);
                    return markdown;
                } catch (error) {
                    this.logger.error(`Error extracting markdown: ${error}`);
                    return `Failed to extract content: ${error instanceof Error ? error.message : String(error)}`;
                }
            }
        });
        tools.push(getMarkdownTool);
        return tools;
    }
    constructor(logger){
        super(logger);
        this.category = 'browser';
    }
}
var __webpack_export_target__ = exports;
for(var __webpack_i__ in __webpack_exports__)__webpack_export_target__[__webpack_i__] = __webpack_exports__[__webpack_i__];
if (__webpack_exports__.__esModule) Object.defineProperty(__webpack_export_target__, '__esModule', {
    value: true
});

//# sourceMappingURL=content-tools.js.map