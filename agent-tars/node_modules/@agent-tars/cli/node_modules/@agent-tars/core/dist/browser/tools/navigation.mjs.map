{"version":3,"file":"browser/tools/navigation.mjs","sources":["webpack://@agent-tars/core/./src/browser/tools/navigation.ts"],"sourcesContent":["/*\n * Copyright (c) 2025 Bytedance, Inc. and its affiliates.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Tool, z } from '@mcp-agent/core';\nimport { ConsoleLogger } from '@mcp-agent/core';\nimport { BrowserGUIAgent } from '../browser-gui-agent';\n\n/**\n * Creates a set of navigation-related browser tools\n *\n * @param logger - Logger for error reporting\n * @param browserGUIAgent - Browser GUI agent instance\n * @returns Array of navigation tools\n */\nexport function createNavigationTools(logger: ConsoleLogger, browserGUIAgent: BrowserGUIAgent) {\n  // Navigate to URL tool\n  const navigateTool = new Tool({\n    id: 'browser_navigate',\n    description: '[browser] Navigate to a URL',\n    parameters: z.object({\n      url: z.string().describe('URL to navigate to'),\n    }),\n    function: async ({ url }) => {\n      try {\n        if (!browserGUIAgent) {\n          return { status: 'error', message: 'GUI Agent not initialized' };\n        }\n\n        const page = await browserGUIAgent.getPage();\n\n        // FIXME: Error: Navigating frame was detached\n        await page.goto(url);\n\n        return {\n          status: 'success',\n          url,\n          message: `Navigated success`,\n        };\n      } catch (error) {\n        logger.error(`Error navigating to URL: ${error}`);\n        return {\n          status: 'error',\n          url,\n          message: `Failed to navigate: ${error instanceof Error ? error.message : String(error)}`,\n        };\n      }\n    },\n  });\n\n  // Back navigation tool\n  const backTool = new Tool({\n    id: 'browser_go_back',\n    description: '[browser] Go back to the previous page, or close tab if no history exists',\n    parameters: z.object({}),\n    function: async () => {\n      try {\n        if (!browserGUIAgent) {\n          return { status: 'error', message: 'GUI Agent not initialized' };\n        }\n\n        const page = await browserGUIAgent.getPage();\n\n        // Check if there's page history to go back to\n        const hasHistory = await page.evaluate(() => {\n          return window.history.length > 1;\n        });\n\n        if (hasHistory) {\n          // If there's history, go back normally\n          await page.goBack();\n          return {\n            status: 'success',\n            message: 'Navigated back',\n          };\n        } else {\n          // If no history, this might be a new tab - handle appropriately\n          const browser = page.browser();\n          const pages = await browser.pages();\n\n          // Only close if there's more than one page\n          if (pages.length > 1) {\n            // Get current page URL for reporting\n            const currentUrl = page.url();\n\n            // Close the current page\n            await page.close();\n\n            logger.info(`Closed tab with URL ${currentUrl} (no history to go back to)`);\n\n            return {\n              status: 'success',\n              message: 'No history available, closed the current tab instead',\n              action: 'closed',\n            };\n          } else {\n            // If it's the only page, navigate to blank page\n            await page.goto('about:blank');\n\n            return {\n              status: 'success',\n              message: 'No history available and only one tab open, navigated to blank page',\n              action: 'blank',\n            };\n          }\n        }\n      } catch (error) {\n        logger.error(`Error handling back navigation: ${error}`);\n        return {\n          status: 'error',\n          message: `Failed to navigate back: ${error instanceof Error ? error.message : String(error)}`,\n        };\n      }\n    },\n  });\n\n  // Forward navigation tool\n  const forwardTool = new Tool({\n    id: 'browser_go_forward',\n    description: '[browser] Go forward to the next page',\n    parameters: z.object({}),\n    function: async () => {\n      try {\n        if (!browserGUIAgent) {\n          return { status: 'error', message: 'GUI Agent not initialized' };\n        }\n\n        const page = await browserGUIAgent.getPage();\n        await page.goForward();\n\n        return {\n          status: 'success',\n          message: 'Navigated forward',\n        };\n      } catch (error) {\n        logger.error(`Error navigating forward: ${error}`);\n        return {\n          status: 'error',\n          message: `Failed to navigate forward: ${error instanceof Error ? error.message : String(error)}`,\n        };\n      }\n    },\n  });\n\n  // Refresh tool\n  const refreshTool = new Tool({\n    id: 'browser_refresh',\n    description: '[browser] Refresh the current page',\n    parameters: z.object({}),\n    function: async () => {\n      try {\n        if (!browserGUIAgent) {\n          return { status: 'error', message: 'GUI Agent not initialized' };\n        }\n\n        const page = await browserGUIAgent.getPage();\n        await page.reload();\n\n        return {\n          status: 'success',\n          message: 'Page refreshed',\n        };\n      } catch (error) {\n        logger.error(`Error refreshing page: ${error}`);\n        return {\n          status: 'error',\n          message: `Failed to refresh: ${error instanceof Error ? error.message : String(error)}`,\n        };\n      }\n    },\n  });\n\n  return [navigateTool, backTool, forwardTool, refreshTool];\n}\n"],"names":["createNavigationTools","logger","browserGUIAgent","navigateTool","Tool","z","url","page","error","Error","String","backTool","hasHistory","window","browser","pages","currentUrl","forwardTool","refreshTool"],"mappings":"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"}