{"version":3,"file":"browser-manager.js","sources":["webpack://@agent-tars/core/./src/browser-manager.ts"],"sourcesContent":["/*\n * Copyright (c) 2025 Bytedance, Inc. and its affiliates.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { LocalBrowser } from '@agent-infra/browser';\nimport { ConsoleLogger } from '@multimodal/mcp-agent';\n\n/**\n * BrowserManager - Singleton manager for Local Browser instance\n *\n * This class implements the Singleton pattern to ensure only one browser instance\n * exists across the application. It provides:\n *\n * 1. Lazy initialization - browser only launches when first needed\n * 2. Lifecycle management - handling browser creation, verification and cleanup\n * 3. Global access - consistent access point to shared browser instance\n */\nexport class BrowserManager {\n  private static instance: BrowserManager | null = null;\n  private browser: LocalBrowser | null = null;\n  private isLaunched = false;\n  private logger: ConsoleLogger;\n\n  private constructor(logger: ConsoleLogger) {\n    this.logger = logger.spawn('BrowserManager');\n    this.logger.info('Browser manager initialized (browser not launched yet)');\n  }\n\n  /**\n   * Get the singleton instance of BrowserManager\n   */\n  public static getInstance(logger: ConsoleLogger): BrowserManager {\n    if (!BrowserManager.instance) {\n      BrowserManager.instance = new BrowserManager(logger);\n    }\n    return BrowserManager.instance;\n  }\n\n  /**\n   * Get the browser instance, creating it if it doesn't exist\n   */\n  public getBrowser(): LocalBrowser {\n    if (!this.browser) {\n      this.logger.info('Creating browser instance (not launched yet)');\n      this.browser = new LocalBrowser({\n        logger: this.logger.spawn('LocalBrowser'),\n      });\n    }\n    return this.browser;\n  }\n\n  /**\n   * Launch the browser with specified options\n   */\n  public async launchBrowser(options: { headless?: boolean } = {}): Promise<void> {\n    if (this.isLaunched) {\n      this.logger.info('Browser already launched, skipping launch');\n      return;\n    }\n\n    try {\n      this.logger.info('üåê Launching browser instance...');\n      const browser = this.getBrowser();\n      await browser.launch(options);\n      // FIXME: Create new page here to avoid the mcp server browser createing\n      // another browser instance, we need a better solution here.\n      // const openingPage = await browser.createPage();\n      // await openingPage.goto('about:blank', {\n      //   waitUntil: 'networkidle2',\n      // });\n      this.isLaunched = true;\n      this.logger.success('‚úÖ Browser instance launched successfully');\n    } catch (error) {\n      this.logger.error(`‚ùå Failed to launch browser: ${error}`);\n      throw error;\n    }\n  }\n\n  /**\n   * Check if the browser is launched\n   */\n  public isLaunchingComplete(): boolean {\n    return this.isLaunched;\n  }\n\n  /**\n   * Check if the browser is alive\n   */\n  public async isBrowserAlive(): Promise<boolean> {\n    if (!this.browser || !this.isLaunched) {\n      return false;\n    }\n    return this.browser.isBrowserAlive();\n  }\n\n  /**\n   * Close the browser instance\n   */\n  public async closeBrowser(): Promise<void> {\n    if (this.browser && this.isLaunched) {\n      try {\n        this.logger.info('Closing browser instance...');\n        await this.browser.close();\n        this.logger.info('Browser instance closed successfully');\n      } catch (error) {\n        this.logger.error(`Error closing browser: ${error}`);\n      } finally {\n        this.isLaunched = false;\n      }\n    }\n  }\n\n  /**\n   * Reset the browser manager state (for testing purposes)\n   */\n  public static resetInstance(): void {\n    BrowserManager.instance = null;\n  }\n}\n"],"names":["BrowserManager","logger","LocalBrowser","options","browser","error"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGC;;;;;;;;;;AAeM,MAAMA;IAcX,OAAc,YAAYC,MAAqB,EAAkB;QAC/D,IAAI,CAACD,eAAe,QAAQ,EAC1BA,eAAe,QAAQ,GAAG,IAAIA,eAAeC;QAE/C,OAAOD,eAAe,QAAQ;IAChC;IAKO,aAA2B;QAChC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YACjB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;YACjB,IAAI,CAAC,OAAO,GAAG,IAAIE,wBAAAA,YAAYA,CAAC;gBAC9B,QAAQ,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC;YAC5B;QACF;QACA,OAAO,IAAI,CAAC,OAAO;IACrB;IAKA,MAAa,cAAcC,UAAkC,CAAC,CAAC,EAAiB;QAC9E,IAAI,IAAI,CAAC,UAAU,EAAE;YACnB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;YACjB;QACF;QAEA,IAAI;YACF,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;YACjB,MAAMC,UAAU,IAAI,CAAC,UAAU;YAC/B,MAAMA,QAAQ,MAAM,CAACD;YAOrB,IAAI,CAAC,UAAU,GAAG;YAClB,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC;QACtB,EAAE,OAAOE,OAAO;YACd,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,4BAA4B,EAAEA,OAAO;YACxD,MAAMA;QACR;IACF;IAKO,sBAA+B;QACpC,OAAO,IAAI,CAAC,UAAU;IACxB;IAKA,MAAa,iBAAmC;QAC9C,IAAI,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,IAAI,CAAC,UAAU,EACnC,OAAO;QAET,OAAO,IAAI,CAAC,OAAO,CAAC,cAAc;IACpC;IAKA,MAAa,eAA8B;QACzC,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,UAAU,EACjC,IAAI;YACF,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;YACjB,MAAM,IAAI,CAAC,OAAO,CAAC,KAAK;YACxB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;QACnB,EAAE,OAAOA,OAAO;YACd,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,uBAAuB,EAAEA,OAAO;QACrD,SAAU;YACR,IAAI,CAAC,UAAU,GAAG;QACpB;IAEJ;IAKA,OAAc,gBAAsB;QAClCL,eAAe,QAAQ,GAAG;IAC5B;IA9FA,YAAoBC,MAAqB,CAAE;QAJ3C,uBAAQ,WAA+B;QACvC,uBAAQ,cAAa;QACrB,uBAAQ,UAAR;QAGE,IAAI,CAAC,MAAM,GAAGA,OAAO,KAAK,CAAC;QAC3B,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;IACnB;AA4FF;AApGE,iBADWD,gBACI,YAAkC"}