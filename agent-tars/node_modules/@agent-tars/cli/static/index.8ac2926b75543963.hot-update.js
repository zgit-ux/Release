"use strict";
self["webpackHotUpdate_agent_tars_web_ui"]("index", {
"./src/entry.css": (function (module, __webpack_exports__, __webpack_require__) {
__webpack_require__.r(__webpack_exports__);
// extracted by css-extract-rspack-plugin

    if(true) {
      (function() {
        var localsJsonString = undefined;
        // 1751739945970
        var cssReload = (__webpack_require__("../node_modules/.pnpm/@rspack+core@1.3.9_@swc+helpers@0.5.17/node_modules/@rspack/core/dist/cssExtractHmr.js")/* .cssReload */.cssReload)(module.id, {});
        // only invalidate when locals change
        if (
          module.hot.data &&
          module.hot.data.value &&
          module.hot.data.value !== localsJsonString
        ) {
          module.hot.invalidate();
        } else {
          module.hot.accept();
        }
        module.hot.dispose(function(data) {
          data.value = localsJsonString;
          cssReload();
        });
      })();
    }
  

}),
"./src/standalone/chat/Message/index.tsx": (function (module, __webpack_exports__, __webpack_require__) {
__webpack_require__.r(__webpack_exports__);
__webpack_require__.d(__webpack_exports__, {
  Message: () => (Message)
});
/* ESM import */var react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__("../node_modules/.pnpm/react@18.3.1/node_modules/react/jsx-dev-runtime.js");
/* ESM import */var react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__("../node_modules/.pnpm/react@18.3.1/node_modules/react/index.js");
/* ESM import */var react__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);
/* ESM import */var _common_utils_typeGuards__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__("./src/common/utils/typeGuards.ts");
/* ESM import */var _common_hooks_useSession__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__("./src/common/hooks/useSession.ts");
/* ESM import */var _common_hooks_useTool__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__("./src/common/hooks/useTool.tsx");
/* ESM import */var _sdk_markdown_renderer__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__("./src/sdk/markdown-renderer/index.tsx");
/* ESM import */var _Message_css__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__("./src/standalone/chat/Message/Message.css");
/* ESM import */var _components_SystemMessage__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__("./src/standalone/chat/Message/components/SystemMessage.tsx");
/* ESM import */var _components_MultimodalContent__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__("./src/standalone/chat/Message/components/MultimodalContent.tsx");
/* ESM import */var _components_ToolCalls__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__("./src/standalone/chat/Message/components/ToolCalls.tsx");
/* ESM import */var _components_ThinkingToggle__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__("./src/standalone/chat/Message/components/ThinkingToggle.tsx");
/* ESM import */var _components_MessageTimestamp__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__("./src/standalone/chat/Message/components/MessageTimestamp.tsx");
/* ESM import */var jotai__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__("../node_modules/.pnpm/jotai@2.12.5_@types+react@18.3.23_react@18.3.1/node_modules/jotai/esm/react.mjs");
/* ESM import */var _common_state_atoms_replay__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__("./src/common/state/atoms/replay.ts");
/* ESM import */var _components_ReportFileEntry__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__("./src/standalone/chat/Message/components/ReportFileEntry.tsx");
/* ESM import */var _common_state_atoms_message__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__("./src/common/state/atoms/message.ts");
/* ESM import */var react_icons_fi__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__("../node_modules/.pnpm/react-icons@4.12.0_react@18.3.1/node_modules/react-icons/fi/index.esm.js");
/* ESM import */var _components_ActionButton__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__("./src/standalone/chat/Message/components/ActionButton.tsx");
/* provided dependency */ var $ReactRefreshRuntime$ = __webpack_require__("../node_modules/.pnpm/@rspack+plugin-react-refresh@1.0.3_react-refresh@0.16.0/node_modules/@rspack/plugin-react-refresh/client/reactRefresh.js");

var _s = $RefreshSig$();






// Import sub-components











/**
 * Message Component - 重构版，移除 isIntermediate 差异
 *
 * 设计原则:
 * - 统一的消息样式，不区分中间和最终状态
 * - 专注于内容，减少视觉干扰
 * - 优雅的样式和排版
 * - 支持便捷的消息复制功能
 */ const Message = (param)=>{
    let { message, isInGroup = false, shouldDisplayTimestamp = true } = param;
    _s();
    const [showThinking, setShowThinking] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(false);
    const [showSteps, setShowSteps] = (0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(false);
    const { setActivePanelContent, activeSessionId } = (0,_common_hooks_useSession__WEBPACK_IMPORTED_MODULE_3__.useSession)();
    const { getToolIcon } = (0,_common_hooks_useTool__WEBPACK_IMPORTED_MODULE_4__.useTool)();
    const replayState = (0,jotai__WEBPACK_IMPORTED_MODULE_16__.useAtomValue)(_common_state_atoms_replay__WEBPACK_IMPORTED_MODULE_12__.replayStateAtom);
    const allMessages = (0,jotai__WEBPACK_IMPORTED_MODULE_16__.useAtomValue)(_common_state_atoms_message__WEBPACK_IMPORTED_MODULE_14__.messagesAtom);
    const isMultimodal = (0,_common_utils_typeGuards__WEBPACK_IMPORTED_MODULE_2__.isMultimodalContent)(message.content);
    const isEnvironment = message.role === 'environment';
    const isUserMessage = message.role === 'user';
    const isFinalAnswer = message.role === 'final_answer' || message.isDeepResearch;
    // Check if this is a final assistant response
    const isFinalAssistantResponse = message.role === 'assistant' && message.finishReason === 'stop';
    // Handle tool call click - show in panel
    const handleToolCallClick = (toolCall)=>{
        if (message.toolResults && message.toolResults.length > 0) {
            const result = message.toolResults.find((r)=>r.toolCallId === toolCall.id);
            if (result) {
                setActivePanelContent({
                    type: result.type,
                    source: result.content,
                    title: result.name,
                    timestamp: result.timestamp,
                    toolCallId: result.toolCallId,
                    error: result.error,
                    arguments: result.arguments,
                    _extra: result._extra
                });
            }
        }
    };
    // Handle click on final assistant response to show latest environment state
    const handleFinalResponseClick = ()=>{
        if (!activeSessionId || !isFinalAssistantResponse) return;
        const sessionMessages = allMessages[activeSessionId] || [];
        // Find the most recent environment input
        for(let i = sessionMessages.length - 1; i >= 0; i--){
            const msg = sessionMessages[i];
            if (msg.role === 'environment' && Array.isArray(msg.content)) {
                const imageContent = msg.content.find((item)=>item.type === 'image_url' && item.image_url && item.image_url.url);
                if (imageContent) {
                    setActivePanelContent({
                        type: 'image',
                        source: msg.content,
                        title: msg.description || 'Final Environment State',
                        timestamp: msg.timestamp,
                        environmentId: msg.id
                    });
                    break;
                }
            }
        }
    };
    // Render content based on type
    const renderContent = ()=>{
        if (isMultimodal) {
            return /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(_components_MultimodalContent__WEBPACK_IMPORTED_MODULE_8__.MultimodalContent, {
                content: message.content,
                timestamp: message.timestamp,
                setActivePanelContent: setActivePanelContent
            }, void 0, false, {
                fileName: "/Users/chenhaoli/workspace/code/UI-TARS-desktop-5/multimodal/agent-tars-web-ui/src/standalone/chat/Message/index.tsx",
                lineNumber: 110,
                columnNumber: 9
            }, undefined);
        }
        // For assistant messages with tool calls, first show summary
        if (message.role === 'assistant' && message.toolCalls && message.toolCalls.length > 0) {
            return /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)("div", {
                className: "prose dark:prose-invert prose-sm max-w-none text-xs",
                children: /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(_sdk_markdown_renderer__WEBPACK_IMPORTED_MODULE_5__.MarkdownRenderer, {
                    content: message.content
                }, void 0, false, {
                    fileName: "/Users/chenhaoli/workspace/code/UI-TARS-desktop-5/multimodal/agent-tars-web-ui/src/standalone/chat/Message/index.tsx",
                    lineNumber: 122,
                    columnNumber: 11
                }, undefined)
            }, void 0, false, {
                fileName: "/Users/chenhaoli/workspace/code/UI-TARS-desktop-5/multimodal/agent-tars-web-ui/src/standalone/chat/Message/index.tsx",
                lineNumber: 121,
                columnNumber: 9
            }, undefined);
        }
        if (isUserMessage) {
            return /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)("div", {
                style: {
                    whiteSpace: 'break-spaces'
                },
                children: message.content
            }, void 0, false, {
                fileName: "/Users/chenhaoli/workspace/code/UI-TARS-desktop-5/multimodal/agent-tars-web-ui/src/standalone/chat/Message/index.tsx",
                lineNumber: 129,
                columnNumber: 9
            }, undefined);
        }
        // Use forceDarkTheme for user messages only
        return /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(_sdk_markdown_renderer__WEBPACK_IMPORTED_MODULE_5__.MarkdownRenderer, {
            content: message.content,
            forceDarkTheme: isUserMessage
        }, void 0, false, {
            fileName: "/Users/chenhaoli/workspace/code/UI-TARS-desktop-5/multimodal/agent-tars-web-ui/src/standalone/chat/Message/index.tsx",
            lineNumber: 140,
            columnNumber: 12
        }, undefined);
    };
    // Determine message bubble style based on role and state
    const getMessageBubbleClasses = ()=>{
        let baseClasses = '';
        if (message.role === 'user') {
            if (isImageOnlyMessage) {
                baseClasses = 'message-user message-user-image';
            } else {
                baseClasses = 'message-user';
            }
        } else if (message.role === 'system') {
            baseClasses = 'message-system';
        } else if (message.role === 'environment') {
            baseClasses = 'environment-message-minimal';
        } else {
            baseClasses = 'message-assistant';
        }
        // 添加更平滑的点击样式
        if (isFinalAssistantResponse) {
            baseClasses += ' cursor-pointer';
        }
        return baseClasses;
    };
    // 检查消息是否只包含图片（用于样式优化）
    const isImageOnlyMessage = react__WEBPACK_IMPORTED_MODULE_1___default().useMemo(()=>{
        if (!(0,_common_utils_typeGuards__WEBPACK_IMPORTED_MODULE_2__.isMultimodalContent)(message.content)) return false;
        const imageContents = message.content.filter((part)=>part.type === 'image_url');
        const textContents = message.content.filter((part)=>part.type === 'text');
        return imageContents.length > 0 && textContents.length === 0;
    }, [
        message.content
    ]);
    // 检查是否有环境状态可显示
    const hasEnvironmentState = react__WEBPACK_IMPORTED_MODULE_1___default().useMemo(()=>{
        if (!activeSessionId || !isFinalAssistantResponse || !allMessages[activeSessionId]) return false;
        const sessionMessages = allMessages[activeSessionId] || [];
        // 检查是否有环境消息
        return sessionMessages.some((msg)=>msg.role === 'environment' && Array.isArray(msg.content) && msg.content.some((item)=>item.type === 'image_url' && item.image_url && item.image_url.url));
    }, [
        activeSessionId,
        isFinalAssistantResponse,
        allMessages
    ]);
    // Determine which prose class should be used, based on message type and dark mode
    const getProseClasses = ()=>{
        if (message.role === 'user') {
            return 'prose prose-invert prose-sm max-w-none';
        } else {
            // For helper messages, use normal prose but apply prose-invert in dark mode
            return 'prose dark:prose-invert prose-sm max-w-none';
        }
    };
    return /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)("div", {
        className: `message-container ${message.role === 'user' ? 'message-container-user' : 'message-container-assistant'}`,
        children: [
            /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)("div", {
                className: `message-bubble ${getMessageBubbleClasses()}`,
                children: message.role === 'system' ? /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(_components_SystemMessage__WEBPACK_IMPORTED_MODULE_7__.SystemMessage, {
                    content: message.content
                }, void 0, false, {
                    fileName: "/Users/chenhaoli/workspace/code/UI-TARS-desktop-5/multimodal/agent-tars-web-ui/src/standalone/chat/Message/index.tsx",
                    lineNumber: 213,
                    columnNumber: 11
                }, undefined) : /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment, {
                    children: [
                        /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)("div", {
                            className: getProseClasses(),
                            children: renderContent()
                        }, void 0, false, {
                            fileName: "/Users/chenhaoli/workspace/code/UI-TARS-desktop-5/multimodal/agent-tars-web-ui/src/standalone/chat/Message/index.tsx",
                            lineNumber: 216,
                            columnNumber: 13
                        }, undefined),
                        isFinalAssistantResponse && hasEnvironmentState && /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)("div", {
                            className: "mt-2",
                            children: /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(_components_ActionButton__WEBPACK_IMPORTED_MODULE_15__.ActionButton, {
                                icon: /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(react_icons_fi__WEBPACK_IMPORTED_MODULE_17__.FiMonitor, {
                                    size: 14
                                }, void 0, false, {
                                    fileName: "/Users/chenhaoli/workspace/code/UI-TARS-desktop-5/multimodal/agent-tars-web-ui/src/standalone/chat/Message/index.tsx",
                                    lineNumber: 221,
                                    columnNumber: 25
                                }, void 0),
                                label: "view final environment state",
                                onClick: handleFinalResponseClick
                            }, void 0, false, {
                                fileName: "/Users/chenhaoli/workspace/code/UI-TARS-desktop-5/multimodal/agent-tars-web-ui/src/standalone/chat/Message/index.tsx",
                                lineNumber: 220,
                                columnNumber: 17
                            }, undefined)
                        }, void 0, false, {
                            fileName: "/Users/chenhaoli/workspace/code/UI-TARS-desktop-5/multimodal/agent-tars-web-ui/src/standalone/chat/Message/index.tsx",
                            lineNumber: 219,
                            columnNumber: 15
                        }, undefined),
                        isFinalAnswer && message.title && typeof message.content === 'string' && /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(_components_ReportFileEntry__WEBPACK_IMPORTED_MODULE_13__.ReportFileEntry, {
                            title: message.title || 'Research Report',
                            timestamp: message.timestamp,
                            content: message.content
                        }, void 0, false, {
                            fileName: "/Users/chenhaoli/workspace/code/UI-TARS-desktop-5/multimodal/agent-tars-web-ui/src/standalone/chat/Message/index.tsx",
                            lineNumber: 229,
                            columnNumber: 15
                        }, undefined),
                        message.toolCalls && message.toolCalls.length > 0 && /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(_components_ToolCalls__WEBPACK_IMPORTED_MODULE_9__.ToolCalls, {
                            toolCalls: message.toolCalls,
                            onToolCallClick: handleToolCallClick,
                            getToolIcon: getToolIcon,
                            toolResults: message.toolResults || []
                        }, void 0, false, {
                            fileName: "/Users/chenhaoli/workspace/code/UI-TARS-desktop-5/multimodal/agent-tars-web-ui/src/standalone/chat/Message/index.tsx",
                            lineNumber: 237,
                            columnNumber: 15
                        }, undefined),
                        message.thinking && /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(_components_ThinkingToggle__WEBPACK_IMPORTED_MODULE_10__.ThinkingToggle, {
                            thinking: message.thinking,
                            showThinking: showThinking,
                            setShowThinking: setShowThinking
                        }, void 0, false, {
                            fileName: "/Users/chenhaoli/workspace/code/UI-TARS-desktop-5/multimodal/agent-tars-web-ui/src/standalone/chat/Message/index.tsx",
                            lineNumber: 246,
                            columnNumber: 15
                        }, undefined)
                    ]
                }, void 0, true)
            }, void 0, false, {
                fileName: "/Users/chenhaoli/workspace/code/UI-TARS-desktop-5/multimodal/agent-tars-web-ui/src/standalone/chat/Message/index.tsx",
                lineNumber: 210,
                columnNumber: 7
            }, undefined),
            message.role !== 'system' && !isInGroup && shouldDisplayTimestamp && !replayState.isActive && /*#__PURE__*/ (0,react_jsx_dev_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxDEV)(_components_MessageTimestamp__WEBPACK_IMPORTED_MODULE_11__.MessageTimestamp, {
                timestamp: message.timestamp,
                content: message.content,
                role: message.role
            }, void 0, false, {
                fileName: "/Users/chenhaoli/workspace/code/UI-TARS-desktop-5/multimodal/agent-tars-web-ui/src/standalone/chat/Message/index.tsx",
                lineNumber: 261,
                columnNumber: 11
            }, undefined)
        ]
    }, void 0, true, {
        fileName: "/Users/chenhaoli/workspace/code/UI-TARS-desktop-5/multimodal/agent-tars-web-ui/src/standalone/chat/Message/index.tsx",
        lineNumber: 207,
        columnNumber: 5
    }, undefined);
}; // ... 保留其他代码 ...
_s(Message, "HQV8xOxq1Cu4aCaRaze6UgHshEI=", false, function() {
    return [
        _common_hooks_useSession__WEBPACK_IMPORTED_MODULE_3__.useSession,
        _common_hooks_useTool__WEBPACK_IMPORTED_MODULE_4__.useTool,
        jotai__WEBPACK_IMPORTED_MODULE_16__.useAtomValue,
        jotai__WEBPACK_IMPORTED_MODULE_16__.useAtomValue
    ];
});
_c = Message;
var _c;
$RefreshReg$(_c, "Message");

function $RefreshSig$() {
  return $ReactRefreshRuntime$.createSignatureFunctionForTransform();
}
function $RefreshReg$(type, id) {
  $ReactRefreshRuntime$.register(type, module.id + "_" + id);
}
Promise.resolve().then(function() {
  $ReactRefreshRuntime$.refresh(module.id, module.hot);
});


}),

},function(__webpack_require__) {
// webpack/runtime/get_full_hash
(() => {
__webpack_require__.h = () => ("c141545aec8a07a6")
})();

}
);
//# sourceMappingURL=index.8ac2926b75543963.hot-update.js.map