"use strict";
self["webpackHotUpdate_agent_tars_web_ui"]("index", {
"./src/entry.css": (function (module, __webpack_exports__, __webpack_require__) {
__webpack_require__.r(__webpack_exports__);
// extracted by css-extract-rspack-plugin

    if(true) {
      (function() {
        var localsJsonString = undefined;
        // 1749664229575
        var cssReload = (__webpack_require__("../node_modules/.pnpm/@rspack+core@1.3.9_@swc+helpers@0.5.17/node_modules/@rspack/core/dist/cssExtractHmr.js")/* .cssReload */.cssReload)(module.id, {});
        // only invalidate when locals change
        if (
          module.hot.data &&
          module.hot.data.value &&
          module.hot.data.value !== localsJsonString
        ) {
          module.hot.invalidate();
        } else {
          module.hot.accept();
        }
        module.hot.dispose(function(data) {
          data.value = localsJsonString;
          cssReload();
        });
      })();
    }
  

}),
"./src/main/hooks/useReplay.ts": (function (module, __webpack_exports__, __webpack_require__) {
__webpack_require__.r(__webpack_exports__);
__webpack_require__.d(__webpack_exports__, {
  useReplay: () => (useReplay)
});
/* ESM import */var jotai__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__("../node_modules/.pnpm/jotai@2.12.5_@types+react@18.3.23_react@18.3.1/node_modules/jotai/esm/react.mjs");
/* ESM import */var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__("../node_modules/.pnpm/react@18.3.1/node_modules/react/index.js");
/* ESM import */var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);
/* ESM import */var _state_atoms_replay__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__("./src/main/state/atoms/replay.ts");
/* ESM import */var _useSession__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__("./src/main/hooks/useSession.ts");
/* ESM import */var _state_atoms_message__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__("./src/main/state/atoms/message.ts");
/* ESM import */var _state_atoms_tool__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__("./src/main/state/atoms/tool.ts");
/* ESM import */var _state_actions_eventProcessor__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__("./src/main/state/actions/eventProcessor.ts");
/* ESM import */var _state_atoms_plan__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__("./src/main/state/atoms/plan.ts");
/* provided dependency */ var $ReactRefreshRuntime$ = __webpack_require__("../node_modules/.pnpm/@rspack+plugin-react-refresh@1.0.3_react-refresh@0.16.0/node_modules/@rspack/plugin-react-refresh/client/reactRefresh.js");
// /agent-tars-web-ui/src/v2/hooks/useReplay.ts









/**
 * Custom hook for managing replay functionality
 *
 * Provides:
 * - Control for playback (play, pause, jump, etc.)
 * - Event processing through the standard event processor
 * - Timeline calculations and positioning
 */ function useReplay() {
    const [replayState, setReplayState] = (0,jotai__WEBPACK_IMPORTED_MODULE_7__.useAtom)(_state_atoms_replay__WEBPACK_IMPORTED_MODULE_1__.replayStateAtom);
    const { activeSessionId } = (0,_useSession__WEBPACK_IMPORTED_MODULE_2__.useSession)();
    const [playbackInterval, setPlaybackInterval] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null);
    const [, setMessages] = (0,jotai__WEBPACK_IMPORTED_MODULE_7__.useAtom)(_state_atoms_message__WEBPACK_IMPORTED_MODULE_3__.messagesAtom);
    const [, setToolResults] = (0,jotai__WEBPACK_IMPORTED_MODULE_7__.useAtom)(_state_atoms_tool__WEBPACK_IMPORTED_MODULE_4__.toolResultsAtom);
    const [, setPlans] = (0,jotai__WEBPACK_IMPORTED_MODULE_7__.useAtom)(_state_atoms_plan__WEBPACK_IMPORTED_MODULE_6__.plansAtom);
    const processEvent = (0,jotai__WEBPACK_IMPORTED_MODULE_7__.useSetAtom)(_state_actions_eventProcessor__WEBPACK_IMPORTED_MODULE_5__.processEventAction);
    /**
   * 重置会话状态并处理事件至指定索引
   */ const processEventsUpToIndex = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((targetIndex)=>{
        if (!activeSessionId || !replayState.events.length || targetIndex < 0) return;
        // 获取需要处理的事件
        const eventsToProcess = replayState.events.slice(0, targetIndex + 1);
        // 清空当前会话状态
        setMessages((prev)=>({
                ...prev,
                [activeSessionId]: []
            }));
        setToolResults((prev)=>({
                ...prev,
                [activeSessionId]: []
            }));
        setPlans((prev)=>({
                ...prev,
                [activeSessionId]: {
                    steps: [],
                    isComplete: false,
                    summary: null,
                    hasGeneratedPlan: false,
                    keyframes: []
                }
            }));
        // 处理环境输入事件优先，确保图片资源先加载
        const envEvents = eventsToProcess.filter((event)=>event.type === 'environment_input');
        const nonEnvEvents = eventsToProcess.filter((event)=>event.type !== 'environment_input');
        // 先处理环境输入事件
        for (const event of envEvents){
            processEvent({
                sessionId: activeSessionId,
                event
            });
        }
        // 然后处理其他事件
        for (const event of nonEnvEvents){
            processEvent({
                sessionId: activeSessionId,
                event
            });
        }
    }, [
        activeSessionId,
        replayState.events,
        setMessages,
        setToolResults,
        setPlans,
        processEvent
    ]);
    /**
   * 开始回放
   */ const startReplay = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{
        // 清除现有的定时器
        if (playbackInterval) {
            clearInterval(playbackInterval);
        }
        setReplayState((prev)=>({
                ...prev,
                isPaused: false
            }));
        // 设置定时器按间隔前进
        const interval = setInterval(()=>{
            setReplayState((prev)=>{
                // 到达末尾时停止
                if (prev.currentEventIndex >= prev.events.length - 1) {
                    clearInterval(interval);
                    return {
                        ...prev,
                        isPaused: true,
                        currentEventIndex: prev.events.length - 1
                    };
                }
                // 前进到下一个事件
                const nextIndex = prev.currentEventIndex + 1;
                // 处理到新位置
                if (activeSessionId) {
                    processEvent({
                        sessionId: activeSessionId,
                        event: prev.events[nextIndex]
                    });
                }
                return {
                    ...prev,
                    currentEventIndex: nextIndex
                };
            });
        }, 500 / replayState.playbackSpeed);
        setPlaybackInterval(interval);
    }, [
        activeSessionId,
        playbackInterval,
        processEvent,
        replayState.playbackSpeed,
        setReplayState
    ]);
    /**
   * 暂停回放
   */ const pauseReplay = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{
        if (playbackInterval) {
            clearInterval(playbackInterval);
            setPlaybackInterval(null);
        }
        setReplayState((prev)=>({
                ...prev,
                isPaused: true
            }));
    }, [
        playbackInterval,
        setReplayState
    ]);
    /**
   * 跳转到时间轴上的指定位置
   */ const jumpToPosition = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((position)=>{
        // 确保位置在有效范围内
        const normalizedPosition = Math.max(0, Math.min(1, position));
        if (replayState.events.length === 0 || !activeSessionId) return;
        // 根据位置计算目标事件索引
        const targetIndex = Math.floor(normalizedPosition * (replayState.events.length - 1));
        // 暂停任何正在进行的回放
        if (playbackInterval) {
            clearInterval(playbackInterval);
            setPlaybackInterval(null);
        }
        // 处理到新位置
        processEventsUpToIndex(targetIndex);
        setReplayState((prev)=>({
                ...prev,
                isPaused: true,
                currentEventIndex: targetIndex
            }));
    }, [
        activeSessionId,
        playbackInterval,
        processEventsUpToIndex,
        replayState.events.length,
        setReplayState
    ]);
    /**
   * 跳转到最终结果
   */ const jumpToResult = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{
        if (replayState.events.length === 0 || !activeSessionId) return;
        const finalIndex = replayState.events.length - 1;
        // 暂停任何正在进行的回放
        if (playbackInterval) {
            clearInterval(playbackInterval);
            setPlaybackInterval(null);
        }
        // 处理到最终位置
        processEventsUpToIndex(finalIndex);
        setReplayState((prev)=>({
                ...prev,
                isPaused: true,
                currentEventIndex: finalIndex
            }));
    }, [
        activeSessionId,
        playbackInterval,
        processEventsUpToIndex,
        replayState.events.length,
        setReplayState
    ]);
    /**
   * 重置回放到初始状态，允许从头开始播放
   */ const resetReplay = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{
        // 暂停任何正在进行的回放
        if (playbackInterval) {
            clearInterval(playbackInterval);
            setPlaybackInterval(null);
        }
        // 处理到初始位置
        processEventsUpToIndex(0);
        setReplayState((prev)=>({
                ...prev,
                isPaused: true,
                currentEventIndex: 0
            }));
    }, [
        playbackInterval,
        processEventsUpToIndex,
        setReplayState
    ]);
    /**
   * 设置播放速度
   */ const setPlaybackSpeed = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)((speed)=>{
        setReplayState((prev)=>({
                ...prev,
                playbackSpeed: speed
            }));
        // 如果正在播放，以新速度重启
        if (!replayState.isPaused && playbackInterval) {
            clearInterval(playbackInterval);
            startReplay();
        }
    }, [
        playbackInterval,
        replayState.isPaused,
        setReplayState,
        startReplay
    ]);
    /**
   * 退出回放模式
   */ const exitReplay = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{
        if (playbackInterval) {
            clearInterval(playbackInterval);
        }
        setReplayState((prev)=>({
                ...prev,
                isActive: false,
                isPaused: true,
                currentEventIndex: -1,
                events: [],
                processedEvents: {}
            }));
    }, [
        playbackInterval,
        setReplayState
    ]);
    /**
   * 获取当前事件
   */ const getCurrentEvent = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{
        if (!replayState.isActive || replayState.currentEventIndex < 0 || replayState.currentEventIndex >= replayState.events.length) {
            return null;
        }
        return replayState.events[replayState.currentEventIndex];
    }, [
        replayState.currentEventIndex,
        replayState.events,
        replayState.isActive
    ]);
    /**
   * 获取当前位置百分比 (0-100)
   */ const getCurrentPosition = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{
        if (!replayState.isActive || replayState.events.length <= 1) {
            return 0;
        }
        return replayState.currentEventIndex / (replayState.events.length - 1) * 100;
    }, [
        replayState.currentEventIndex,
        replayState.events.length,
        replayState.isActive
    ]);
    /**
   * 获取当前所有事件
   */ const getCurrentEvents = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{
        if (!replayState.isActive || replayState.currentEventIndex < 0) {
            return [];
        }
        return replayState.events.slice(0, replayState.currentEventIndex + 1);
    }, [
        replayState.currentEventIndex,
        replayState.events,
        replayState.isActive
    ]);
    // 组件卸载时清理定时器
    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{
        return ()=>{
            if (playbackInterval) {
                clearInterval(playbackInterval);
            }
        };
    }, [
        playbackInterval
    ]);
    // 回放模式初始化时：如果索引为-1，需要手动触发第一步，否则会显示为空白
    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{
        if (replayState.isActive && replayState.currentEventIndex === -1 && replayState.events.length > 0) {
            // 如果启动回放后立即跳到第一个事件
            processEventsUpToIndex(0);
            setReplayState((prev)=>({
                    ...prev,
                    currentEventIndex: 0
                }));
        }
    }, [
        replayState.isActive,
        replayState.currentEventIndex,
        replayState.events.length,
        processEventsUpToIndex,
        setReplayState
    ]);
    /**
   * 取消自动播放倒计时
   */ const cancelAutoPlay = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(()=>{
        setReplayState((prev)=>({
                ...prev,
                autoPlayCountdown: null
            }));
    }, [
        setReplayState
    ]);
    // 添加对自动播放事件的监听
    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{
        const handleAutoStart = ()=>{
            console.log('Auto-play event received, starting replay...');
            startReplay();
        };
        // 添加事件监听器
        window.addEventListener('replay-autostart', handleAutoStart);
        // 清理函数
        return ()=>{
            window.removeEventListener('replay-autostart', handleAutoStart);
        };
    }, [
        startReplay
    ]); // 依赖于startReplay函数
    return {
        // 状态
        replayState,
        // 操作方法
        startReplay,
        pauseReplay,
        jumpToPosition,
        jumpToResult,
        setPlaybackSpeed,
        exitReplay,
        cancelAutoPlay,
        resetReplay,
        // 工具方法
        getCurrentEvents,
        getCurrentPosition,
        getCurrentEvent
    };
}

function $RefreshSig$() {
  return $ReactRefreshRuntime$.createSignatureFunctionForTransform();
}
function $RefreshReg$(type, id) {
  $ReactRefreshRuntime$.register(type, module.id + "_" + id);
}
Promise.resolve().then(function() {
  $ReactRefreshRuntime$.refresh(module.id, module.hot);
});


}),

},function(__webpack_require__) {
// webpack/runtime/get_full_hash
(() => {
__webpack_require__.h = () => ("4bbb5bc95766f16d")
})();

}
);
//# sourceMappingURL=index.7f4bd2859b7ae4f2.hot-update.js.map